"use strict";
/**
 * @license
 * Copyright 2019 Ludan Stoecklé
 * SPDX-License-Identifier: Apache-2.0
 */
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
exports.LanguageGerman = void 0;
const LanguageImpl_1 = require("./LanguageImpl");
const german_determiners_1 = require("german-determiners");
const german_adjectives_1 = require("german-adjectives");
const adjectives_json_1 = __importDefault(require("german-adjectives-dict/dist/adjectives.json"));
const german_words_1 = require("german-words");
const words_json_1 = __importDefault(require("german-words-dict/dist/words.json"));
const german_ordinals_1 = require("german-ordinals");
require("numeral/locales/de");
const locale_1 = require("date-fns/locale");
const german_grammar_js_1 = require("../dist/german-grammar.js");
const german_dict_helper_1 = require("german-dict-helper");
const german_verbs_1 = require("german-verbs");
const verbs_json_1 = __importDefault(require("german-verbs-dict/dist/verbs.json"));
const n2words_DE_js_1 = __importDefault(require("../../rosaenlg-n2words/dist/n2words_DE.js"));
class LanguageGerman extends LanguageImpl_1.LanguageImpl {
    constructor(languageCommon) {
        super(languageCommon);
        this.iso2 = 'de';
        this.langForNumeral = 'de';
        this.langForDateFns = locale_1.de;
        this.n2wordsLang = 'de';
        this.n2wordsLib = n2words_DE_js_1.default;
        this.floatingPointWord = 'Komma';
        this.table0to9 = ['null', 'eins', 'zwei', 'drei', 'vier', 'fünf', 'sechs', 'sieben', 'acht', 'neun'];
        this.hasGender = true;
        this.hasNeutral = true;
        this.defaultAdjPos = 'BEFORE';
        this.hasCase = true;
        this.defaultCase = 'NOMINATIVE';
        this.userGenderOwnedForGender = true;
        this.supportsInvertSubjectVerb = true;
        this.defaultTense = 'PRASENS';
        this.canPopVerbPart = true;
        this.canPopVerbPrefix = true;
        this.defaultLastSeparatorForAdjectives = 'und';
        this.universalMapping = {
            UNIVERSAL_PRESENT: 'PRASENS',
            UNIVERSAL_PAST: 'PRATERITUM',
            UNIVERSAL_FUTURE: 'FUTUR1',
            UNIVERSAL_PERFECT: 'PERFEKT',
            UNIVERSAL_PLUPERFECT: 'PLUSQUAMPERFEKT',
        };
        this.spacesWhenSeparatingElements = true;
        try {
            this.dictHelper = new german_dict_helper_1.GermanDictHelper();
        }
        catch (err) {
            // this means that we are in a browser
        }
    }
    getDet(det, params) {
        return (0, german_determiners_1.getDet)(det, params.case, params.genderOwner, params.numberOwner || 'S', params.genderOwned, params.numberOwned || 'S');
    }
    getAgreeAdj(adjective, gender, number, _subject, params) {
        return (0, german_adjectives_1.agreeGermanAdjective)(this.getDictManager().getAdjsData(), adjectives_json_1.default, //NOSONAR
        adjective, params.case, gender, number, params.det);
    }
    getWordGender(word) {
        return (0, german_words_1.getGenderGermanWord)(this.getDictManager().getWordData(), words_json_1.default, word); //NOSONAR
    }
    getOrdinal(val, _gender) {
        return (0, german_ordinals_1.getOrdinal)(val);
    }
    getSubstantive(subst, number, theCase) {
        if (number === 'S' && theCase === 'NOMINATIVE') {
            return subst;
        }
        else {
            return (0, german_words_1.getCaseGermanWord)(this.getDictManager().getWordData(), words_json_1.default, subst, theCase, number); //NOSONAR
        }
    }
    parseSimplifiedString(val) {
        return (0, german_grammar_js_1.parse)(val, { dictHelper: this.dictHelper });
    }
    thirdPossessionTriggerRef(owner, owned, params) {
        this.valueManager.value(owned, Object.assign({}, params, { det: 'DEFINITE' }));
        this.helper.insertSeparatingSpaceIfRequired();
        this.valueManager.value(owner, Object.assign({}, params, { case: 'GENITIVE' }));
    }
    thirdPossessionRefTriggered(owner, owned, params) {
        const germanCase = params && params.case ? params.case : 'NOMINATIVE';
        const det = this.getDet('POSSESSIVE', {
            genderOwner: this.genderNumberManager.getRefGender(owner, params),
            numberOwner: this.genderNumberManager.getRefNumber(owner, params),
            genderOwned: this.genderNumberManager.getRefGender(owned, params),
            numberOwned: this.genderNumberManager.getRefNumber(owned, params),
            case: germanCase,
            dist: undefined,
            after: undefined,
            useTheWhenPlural: undefined,
        });
        /*
          3. flex the word
          getCaseGermanWord always returns something (not null)
          UNSURE ABOUT numberOwned / owner?
        */
        const declinedWord = (0, german_words_1.getCaseGermanWord)(this.getDictManager().getWordData(), words_json_1.default, //NOSONAR
        owned, germanCase, this.genderNumberManager.getRefNumber(owner, params) || 'S');
        this.getSpy().appendPugHtml(` ${det} ${declinedWord} `);
    }
    isVerbWithPrefix(verb, embeddedVerbs) {
        return (0, german_verbs_1.getVerbInfo)(embeddedVerbs || verbs_json_1.default, verb).hasPrefix;
    }
    getConjugation(_subject, verb, originalTense, person, conjParams, embeddedVerbs, verbParts, verbPrefixes) {
        const solvedTense = this.solveTense(originalTense);
        const tensesWithParts = [
            'FUTUR1',
            'FUTUR2',
            'PERFEKT',
            'PLUSQUAMPERFEKT',
            'KONJUNKTIV1_FUTUR1',
            'KONJUNKTIV1_PERFEKT',
            'KONJUNKTIV2_FUTUR1',
            'KONJUNKTIV2_FUTUR2',
        ];
        let pronominal = false;
        let pronominalCase = undefined;
        if (conjParams && conjParams.pronominal) {
            pronominal = true;
            pronominalCase = conjParams.pronominalCase;
        }
        if (tensesWithParts.indexOf(solvedTense) > -1) {
            // 'wird sein'
            // istanbul ignore next
            const aux = conjParams ? conjParams.aux : undefined;
            const conjElts = (0, german_verbs_1.getConjugation)(embeddedVerbs || verbs_json_1.default, verb, solvedTense, this.mapPersonToNumber1to3(person), this.mapPersonToSP(person), aux, pronominal, pronominalCase);
            verbParts.push(conjElts.slice(1).join('¤')); // FUTUR2: 'wird gedacht haben'
            return conjElts[0];
        }
        else {
            const conjElts = (0, german_verbs_1.getConjugation)(embeddedVerbs || verbs_json_1.default, verb, solvedTense, this.mapPersonToNumber1to3(person), this.mapPersonToSP(person), undefined, pronominal, pronominalCase);
            if (conjElts.length === 1) {
                return conjElts[0];
            }
            else {
                // when the verb has a prefix, the result is split in 2: conj verb + prefix, e.g. ['schaue', 'an']
                const prefix = conjElts[1];
                const rest = conjElts[0];
                if (conjParams.splitPrefix === false) {
                    return prefix + rest;
                }
                else {
                    // we keep the prefix for later use
                    verbPrefixes.push(prefix);
                    return rest;
                }
            }
        }
    }
    isPlural(val) {
        // https://german.stackexchange.com/questions/26806/numerus-beim-zahlenwort-null
        // looks the same as in English
        if (val === 1 || val === -1) {
            return false;
        }
        else {
            return true;
        }
    }
}
exports.LanguageGerman = LanguageGerman;
//# sourceMappingURL=LanguageGerman.js.map